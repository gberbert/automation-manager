# Agent Memory RAG

## Histórico de Alterações

### [2025-12-28T09:15:00-03:00] - Implementação de Modo Overwrite na Regeneração de Imagem
**O que foi feito:**
- Atualização do Frontend (`Approvals.jsx`) para incluir um seletor de modo ("Refinar/Injection" vs "Sobrescrever") no modal de regeneração de imagem.
- Atualização da lógica de construção do prompt:
  - **Injection:** Mantém comportamento anterior (Prompt Original + Instrução).
  - **Overwrite:** Usa apenas a instrução fornecida como novo prompt.
- Atualização do Backend (`server/index.js`) para salvar o `imagePrompt` atualizado no Firestore durante a regeneração.

**Motivo:**
- O usuário solicitou a capacidade de substituir totalmente o prompt de imagem em vez de apenas refiná-lo, pois o método de "injection" às vezes não era suficiente para mudanças drásticas.
- O Backend não estava persistindo o prompt atualizado, o que causava inconsistências em refinamentos futuros.

**Snapshot de Segurança (Código Deprecated):**

*Frontend (Approvals.jsx - Lógica anterior de prompt):*
```javascript
// Antes
let finalPrompt = regenTargetPost.imagePrompt || `Photo about ${regenTargetPost.topic}`;
if (regenInstruction.trim()) {
    finalPrompt += `. INSTRUCTION: ${regenInstruction.trim()}`;
}
```

*Backend (server/index.js - Update anterior):*
```javascript
// Antes (Não salvava o prompt)
await db.collection('posts').doc(postId).update({ imageUrl: media.imageUrl, modelUsed: media.modelUsed });
```
